
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>node.js 의 koa 쉽게 사용하기-YEOL</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">node.js 의 koa 쉽게 사용하기-YEOL</h2>
                                <div class="box-info">
                                    <p class="category">TS, JS/nodejs</p>
                                    <p class="date">2020-07-07 15:24:14</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p>&nbsp;</p>
<p>&nbsp;</p>
<p><figure class="imageblock alignCenter" data-filename="koa.png" data-origin-width="576" data-origin-height="527" width="430" height="NaN" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img.png" data-filename="koa.png" data-origin-width="576" data-origin-height="527" width="430" height="NaN" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption></figcaption>
</figure></p>
<p>&nbsp;</p>
<p>koa를 간단히 설명하자면 express와 같은 node.js에서 서버를 실행하기 위해 사용하는 웹 프레임워크입니다.</p>
<p>express의 개발자분들이 만드셨고 특징은 가벼움과 비동기 작업을 정식 지원하는 부분입니다.</p>
<p>써 내려가면서 설명하겠습니다. (큰 차이는 잘 느껴지지 않았습니다.)</p>
<h2 data-ke-size="size26">&nbsp;</h2>
<h2 data-ke-size="size26">- 초기 설정</h2>
<p>&nbsp;</p>
<p>yarn init -y를 실행하여 본인이 원하는 폴더에 파일을 생성합니다.</p>
<p>yarn add koa를 통해 해당 프레임워크를 다운로드합니다.</p>
<p><a href="https://www.npmjs.com/package/koa">https://www.npmjs.com/package/koa</a></p>
<figure id="og_1594020257428" contenteditable="false" data-ke-type="opengraph" data-og-type="website" data-og-title="koa" data-og-description="Koa web app framework" data-og-host="www.npmjs.com" data-og-source-url="https://www.npmjs.com/package/koa" data-og-url="https://www.npmjs.com/package/koa" data-og-image="https://scrap.kakaocdn.net/dn/im3dr/hyGFWPaccP/UrkvMhDttfPr9RfQ6yjEyk/img.png?width=1200&amp;height=630&amp;face=0_0_1200_630,https://scrap.kakaocdn.net/dn/bzwWtn/hyGFWVV2db/3TV9h6FqMUm969dkYF4Fe1/img.png?width=1020&amp;height=790&amp;face=0_0_1020_790"><a href="https://www.npmjs.com/package/koa" target="_blank" rel="noopener" data-source-url="https://www.npmjs.com/package/koa">
<div class="og-image" style="background-image: url('https://scrap.kakaocdn.net/dn/im3dr/hyGFWPaccP/UrkvMhDttfPr9RfQ6yjEyk/img.png?width=1200&amp;height=630&amp;face=0_0_1200_630,https://scrap.kakaocdn.net/dn/bzwWtn/hyGFWVV2db/3TV9h6FqMUm969dkYF4Fe1/img.png?width=1020&amp;height=790&amp;face=0_0_1020_790');">&nbsp;</div>
<div class="og-text">
<p class="og-title">koa</p>
<p class="og-desc">Koa web app framework</p>
<p class="og-host">www.npmjs.com</p>
</div>
</a></figure>
<p>&nbsp;</p>
<p>src폴더를 생성하고 index.js 파일을 폴더 내부에 생성합니다.</p>
<p>&nbsp;</p>
<pre id="code_1594020500806" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>const Koa = require('koa');

const app = new Koa();

app.use(ctx =&gt;{              // ctx는 context의 줄임말로 웹의 요청과 응답의 정보를 지닌다.
  ctx.body='hello world';    //req와 res를 한번에 ctx로 사용한다고 생각하면된다.
});							// app.use((req,res)=&gt;{}) 이게 익스프레스면 ctx는 하나로 쓴다.


app.listen(4000, ()=&gt;{
  console.log('Listening to port 4000');
});
</code></pre>
<p>&nbsp;</p>
<p>명령 프롬프트에서 본인의 폴더 경로에 node src를 실행해주세요.</p>
<p>localhost:4000를 주소창에 입력하고 엔터를 눌러주세요.</p>
<p>화면에 hello world 가 잘 나타난다면 기본이 끝났습니다.</p>
<h2 data-ke-size="size26">&nbsp;</h2>
<h2 data-ke-size="size26">- next함수 promise 반환</h2>
<p>&nbsp;</p>
<p>koa는 promise 형태의 반환이 가능합니다. 비동기 실행을 정식으로 지원하며 큰 특징입니다.</p>
<p>&nbsp;</p>
<pre id="code_1594021860050" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>const Koa = require('koa');
const app = new Koa();
 
 ///////////////////// 요부분이 비동기가 현재 일어나는 부분입니다.
app.use((ctx,next)=&gt;{

  console.log(1);
  console.log(ctx.url);
  if(ctx.query.authorized !== '1'){
    ctx.status=401;
    return;
  }
  next().then(()=&gt;{     //다음 next실행이 완료된 후에 end가 실행된다.
    console.log('END');
  });
});
////////////////////////////////
app.use((ctx,next)=&gt;{
console.log(2);
next();
});

app.use(ctx =&gt;{
  ctx.body = "hello world";
});

app.listen(4000, ()=&gt;{
  console.log('Listening to port 4000');
});
</code></pre>
<p>로컬 4000의 query값을 비교할 때 값이 1이 아니면 status=401 설정을 하여 문서를 <span style="color: #333333;">Unauthorized<span> 상태로 표출합니다.</span></span><span style="color: #333333;"><span></span></span></p>
<p><a href="http://localhost:4000/?authorized=1">http://localhost:4000/? authorized=1와</a> <a href="http://localhost:4000/?authorized=1">http://localhost:4000의</a> 검색 결과를 보면 알 수 있습니다.</p>
<p>express에 대한 기반 지식이 있으시다면 이해가 용이할 것입니다.</p>
<p>&nbsp;async와 await으로도 위의 비동기 처리가 가능합니다.</p>
<p>&nbsp;</p>
<pre id="code_1594022489217" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>위의 비동기부분 처리
app.use(async(ctx,next)=&gt;{

  console.log(1);
  console.log(ctx.url);
  if(ctx.query.authorized !== '1'){
    ctx.status=401;
    return;
  }
    await next();
    console.log('END');
});</code></pre>
<p>&nbsp;</p>
<h2 data-ke-size="size26">- koa router 사용하기&nbsp;</h2>
<p>&nbsp;</p>
<p><a href="https://www.npmjs.com/package/koa-router">https://www.npmjs.com/package/koa-router</a></p>
<figure id="og_1594025802110" contenteditable="false" data-ke-type="opengraph" data-og-type="website" data-og-title="koa-router" data-og-description="Router middleware for koa. Provides RESTful resource routing." data-og-host="www.npmjs.com" data-og-source-url="https://www.npmjs.com/package/koa-router" data-og-url="https://www.npmjs.com/package/koa-router" data-og-image="https://scrap.kakaocdn.net/dn/co1Isu/hyGFPCCGww/m4cKu8VZBM2U2NKsqVwkc0/img.png?width=1200&amp;height=630&amp;face=0_0_1200_630"><a href="https://www.npmjs.com/package/koa-router" target="_blank" rel="noopener" data-source-url="https://www.npmjs.com/package/koa-router">
<div class="og-image" style="background-image: url('https://scrap.kakaocdn.net/dn/co1Isu/hyGFPCCGww/m4cKu8VZBM2U2NKsqVwkc0/img.png?width=1200&amp;height=630&amp;face=0_0_1200_630');">&nbsp;</div>
<div class="og-text">
<p class="og-title">koa-router</p>
<p class="og-desc">Router middleware for koa. Provides RESTful resource routing.</p>
<p class="og-host">www.npmjs.com</p>
</div>
</a></figure>
<p>&nbsp;</p>
<p>yarn add koa-router를 사용하여 koa의 라우터를 추가합니다.</p>
<p>&nbsp;</p>
<pre id="code_1594025615398" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>const Koa = require('koa');
const Router = require ('koa-router'); //라우터 

const app = new Koa();
const router = new Router(); //라우터 설정


router.get('/', ctx =&gt;{
  ctx.body= 'index페이지 (첫페이지)';
});

router.get('/blue', ctx =&gt;{
  ctx.body= '파랑파랑';
});
router.get('/red', ctx =&gt;{
  ctx.body= '빨강빨강';
});

app.use(router.routes());  //설정한 라우터들을 적용합니다.

app.listen(4000, ()=&gt;{
  console.log('Listening to port 4000');
});
</code></pre>
<p>&nbsp;</p>
<p>기본 페이지와 blue, red 페이지를 만들고 koa 서버를 실행합니다.</p>
<p>요렇게 모양이 잘 나오면 성공입니다.</p>
<p><figure class="imageblock alignCenter" data-origin-width="0" data-origin-height="0" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img_1.png" data-origin-width="0" data-origin-height="0" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption></figcaption>
</figure></p>
<p>아주아주 간단한 웹에서의 router기능이 완성되었습니다.</p>
<p>모듈화를 진행해보겠습니다 이 또한 단순합니다.</p>
<p>코드부터 살펴보겠습니다.</p>
<p><figure class="imageblock alignCenter" data-origin-width="0" data-origin-height="0" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img_2.png" data-origin-width="0" data-origin-height="0" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption></figcaption>
</figure><figure class="imageblock alignCenter" data-origin-width="0" data-origin-height="0" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img_3.png" data-origin-width="0" data-origin-height="0" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption></figcaption>
</figure></p>
<p><a href="http://app.use(router.routes());" target="_blank" rel="noopener">12 행은 이렇게 해도 됩니다. app.use(router.routes());</a> 단 post나 get 같은 restApi 메서드를 사용할 때 적용이 안 된 경우</p>
<p>allowedMethods를 해줘야 에러가 안 뜨고 '<span style="color: #333333;">allowedMethods</span>' 문구가 출력됩니다.</p>
<p>- rest api 란 요청 종류에 따라 다른 http의 메서드를 사용합니다. (하단의 restApi 종류)</p>
<p data-ke-size="size14">[&nbsp; &nbsp;get : 데이터 조회 시 사용합니다. ㅣ post : 데이터 등록이나 인증 시 사용합니다. ㅣ delete :데이터를 지울 때 사용합니다.</p>
<p data-ke-size="size14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;put : 데이터를 통째로 교환할 때 사용합니다.&nbsp; ㅣ&nbsp; patch : 데이터의 특정 필드를 수정할 때 사용합니다.&nbsp; &nbsp;]</p>
<p>&nbsp;</p>
<p>현재 index페이지에 불러온 모듈 api.routes를 현재 router 추가합니다. 그러면 router에 api 모듈을 통한 경로도</p>
<p>사용 가능하고 후에 router의 routes를 이용해 express에도 use를 사용하여 적용해줍니다.</p>
<p>이렇게 하면 예를 들어 api경로를 통해 무수히 많은 경로가 있을 때 나눠놓는 것이 가능합니다.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>이해하기 최대한 간편하게 koa의 기능을 살펴보았습니다. 도움이 되셨길 바랍니다.</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #KOA #koa.js #node.js koa 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
