
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>[ Linux ] 내가 써먹을 Node 배포 과정으로 프론트, 백엔드, DB 환경 설정하기 - YEOL</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">[ Linux ] 내가 써먹을 Node 배포 과정으로 프론트, 백엔드, DB 환경 설정하기 - YEOL</h2>
                                <div class="box-info">
                                    <p class="category">OS/Linux</p>
                                    <p class="date">2022-04-04 14:59:15</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <h4 data-ke-size="size20">환경&nbsp;</h4>
<p data-ke-size="size16">CentOS Stream 8</p>
<h4 data-ke-size="size20">개요</h4>
<p data-ke-size="size16">CentOS 개발까지 기본 환경 세팅하기이며 제가 볼 용도입니다. 키워드는 다 넣어놓고 부족한 부분은 검색합시다.</p>
<h4 data-ke-size="size20">목차</h4>
<ul style="list-style-type: disc;" data-ke-list-type="disc">
<li>환경설정</li>
<li><span style="letter-spacing: 0px;">위와 같은 진행을 하는 설명글</span></li>
</ul>
<h2 data-ke-size="size26"><b>&nbsp;</b></h2>
<h2 data-ke-size="size26"><b>- 환경설정</b></h2>
<p data-ke-size="size16">vmware, azure, aws 등에서 centos를 만들어준 상태에서 시작합니다.</p>
<p data-ke-size="size16">방화벽 관련해서는 알아서 뚫어줍시다. 서버는 3개라는 가정하에 진행합니다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">- 백엔드 서버</p>
<p data-ke-size="size16">먼저 node를 설치합니다.</p>
<pre id="code_1649046062126" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>https://rpm.nodesource.com #아래의 node 설치를 설명해주는 git 사이트

curl -sL https://rpm.nodesource.com/setup_16.x | sudo -E bash #지금 lts인 16버전 설치
yum clean all #캐시 제거
yum install -y nodejs #node 설치</code></pre>
<p data-ke-size="size16">node와 npm 확인 및 pm2 설치해줍니다.</p>
<pre id="code_1649046707119" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>node -v #잘 설치되었는지 확인 하고 update 하라고 뜨면하시면됩니다.

npm i -g --save pm2 #서버 무중단 및 클러스터 관리를 위해 pm2 부터 설치</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">- 프런트 서버</p>
<p data-ke-size="size16">프런트 빌드 파일을 실행할 nginx 설치합니다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<pre id="code_1649049632357" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>https://www.nginx.com/resources/wiki/start/topics/tutorials/install/  #구글에 nginx install ㄱㄱ
#정해진 경로에 nginx.repo 로 아래의 글을 넣은 파일을 vi로 만들어주면댐
# baseurl 링크는 실제로 들어가서 본인한테 맞게 넣어도 되고 일단 난 centos 8버전이니까 8 넣음
# [root@localhost yum.repos.d]# pwd  -&gt; /etc/yum.repos.d


[nginx]
name=nginx repo
baseurl=https://nginx.org/packages/centos/8/$basearch/ 
gpgcheck=0
enabled=1</code></pre>
<p data-ke-size="size16">저장소 등록했으면 설치하고 시작해줍니다.</p>
<pre id="code_1649049690309" class="html xml" data-ke-language="html" data-ke-type="codeblock"><code>yum install nginx -y # 설치 ㄱㄱ
systemctl start nginx #시작하기
systemctl enable nginx #nginx 서비스 자동 시작하기</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">- 데이터베이스</p>
<p data-ke-size="size16">MariaDB 도 위처럼 repo 만들고 설치를 진행합니다.</p>
<p data-ke-size="size16"><span style="color: #006dd7;"><b><a style="color: #006dd7;" href="https://server-talk.tistory.com/240" target="_blank" rel="noopener">리플리케이션 참조를 할지</a></b></span> <span style="color: #006dd7;"><b><a style="color: #006dd7;" href="https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&amp;blogId=taemojin&amp;logNo=221577342665" target="_blank" rel="noopener">클러스터링 갈레라 참조를</a></b></span> 할지 고민합시다.&nbsp;</p>
<p data-ke-size="size16"><span style="color: #006dd7;"><b><a style="color: #006dd7;" href="https://dev-youngjun.tistory.com/97" target="_blank" rel="noopener">HAProxy참조</a></b></span> Nginx도 LB가 가능하지만 DB 맞춤형으로 가줍시다.</p>
<p data-ke-size="size16">장애 대응 및 부하분산을 위함입니다.</p>
<p data-ke-size="size16">&nbsp;</p>
<h2 data-ke-size="size26"><b>- 위와 같은 진행을 하는 설명글</b></h2>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"># nginx는 worker_processes auto; cpu 돌리고 나중에 scaleout 해서 lb 합시다<br /># pm2는 cluster 여러 개 돌려서 cpu 돌립시다<br /># 둘 다 lb는 aws나 azure 기능으로 하거나 nginx로 lb 가능 pm2도 nginx로 lb 하면 됩니다.<br /># url별로 lb해도 만약 하나의 서버가 터지면 nginx나 클라우드 서비스에서 lb 처리 가능합니다.</p>
<p data-ke-size="size16"># 무중단 배포에 관련한 좋은 <b><span style="color: #006dd7;"><a style="color: #006dd7;" href="https://velog.io/@kakasoo/Node.js%EC%9D%98-Clustering-Module-%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%8B%B1">링크 참조</a></span></b></p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">pm2와 nginx를 이용했지만 기본적으로 프로세스 max로 돌리고 및 LB와 장애 대응, 무중단 배포를 생각해야 합니다.<br />유저가 존재하는 서비스 -&gt; 유저가 존재하면 부하분산, 장애 판단이 무조건 돼야 합니다.<br />무중단으로 aws 블루 그린이나 도커 언급 안 하는 이유는 aws는 돈이 들고 도커는 쓰는 회사면 쓰세요.</p>
<p data-ke-size="size16">모놀리딕일 때 위처럼 하다가 MSA로 빠지면 비즈니스 도메인별로 분리하고 똑같이 개발하면 됩니다.<br />db 쪽은 erd클라우드로 설계 잘하고 스키마 인덱싱도 해줍시다.&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">Ngrok 엔그록 사용하기 -&gt;</p>
<p data-ke-size="size16">돈 아까워서 Aws 같은 거 쓰기 싫을 때 VmWare로 서버 3개 돌리고 API 통신 잘 확인한 다음 프런트만 Ngrok 도메인 무료로 연결해주면 외부 접속 가능 즉 내부에서 통신하고 외부 도메인만 무료로 열어준다고 생각하면 됩니다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">근거 있는 조언은 언제나 환영합니다. 성실한 코딩 하세요.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #환경설정 #부하분산 #MSA #백엔드 #장애대응 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
